<!doctype html>
<html lang="en">
  <head>
    <title>Edit Profile</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
      .edit-card {
        max-width: 700px;
        margin: 2rem auto;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
      }
      .profile-img, .avatar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        cursor: pointer;
        object-fit: cover;
      }
      .avatar {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #0d6efd;
        color: white;
        font-size: 3rem;
        font-weight: bold;
      }
      #fileInput {
        display: none;
      }
    </style>
  </head>
  <body>
    <header>
      <%- include('../partials/header') %>
    </header>

    <main>
      <div class="card edit-card">
        <h3 class="mb-4">Edit Profile</h3>

        <!-- Profile Image / Avatar -->
        <div class="text-center mb-4">
          <% if (user.profileImage) { %>
            <img src="<%= user.profileImage %>" alt="Profile Picture" class="profile-img" id="profilePic" />
          <% } else { %>
            <div class="avatar" id="profileAvatar"><%= user.username.charAt(0).toUpperCase() %></div>
          <% } %>
          <form id="uploadForm" action="/user/upload" method="POST" enctype="multipart/form-data">
            <input type="file" name="profileImage" id="fileInput" accept="image/*" />
          </form>
        </div>

        <!-- Editable Form -->
        <form action="/user/edit" method="POST">
          <div class="mb-3">
            <label for="fullName" class="form-label">Full Name</label>
            <input type="text" class="form-control" id="fullName" name="fullName" value="<%= user.fullName %>" required>
          </div>

          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username" name="username" value="<%= user.username %>" required>
          </div>

          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="<%= user.email %>" required>
          </div>

          <div class="mb-3">
            <label for="phone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="phone" name="phone" value="<%= user.phone || '' %>">
          </div>

          <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <input type="text" class="form-control" id="address" name="address" value="<%= user.address || '' %>">
          </div>

          <div class="mb-3">
            <label for="bio" class="form-label">Bio</label>
            <textarea class="form-control" id="bio" name="bio" rows="3"><%= user.bio || '' %></textarea>
          </div>

          <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
      </div>
    </main>

    <footer>
      <%- include('../partials/footer') %>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const avatar = document.getElementById("profileAvatar");
      const profilePic = document.getElementById("profilePic");
      const fileInput = document.getElementById("fileInput");

      if (avatar) avatar.addEventListener("click", () => fileInput.click());
      if (profilePic) profilePic.addEventListener("click", () => fileInput.click());

      if (fileInput) {
        fileInput.addEventListener("change", () => {
          if (fileInput.files.length > 0) document.getElementById("uploadForm").submit();
        });
      }
    </script>
  </body>
</html>
